<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card flex justify-content-between align-items-center">
        <div class="p-2 h-full w-full flex flex-column justify-content-between">
          <div class="flex align-items-center justify-content-between mb-3">
            <div class="p-col-6">
              <h5>Livres</h5>
            </div>
            <div class="flex align-items-center gap-2 ">
              <button pButton pRipple label="Ajouter" icon="pi pi-plus-circle" (click)="onDisplayDialog(editForm)"></button>
              <button pButton pRipple label="Suppression" icon="pi pi-trash"
                      [disabled]="livreSelected.length<1"
                      class="p-button-danger" (click)="supprimer()"></button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      <div class="card">
        <p-table #dt  styleClass="p-datatable-responsive-demo p-datatable-sm p-datatable"

                 [value]="livres"
                 [rows]="3" dataKey="id"
                 [(selection)]="livreSelected"
                 sortMode="multiple"
                 [globalFilterFields]="['titre','genre.libelle','edition','auteur.nom']"
                 [paginator]="true"
                 [loading]="loading"
                 scrollHeight="600px"
                 dataKey="id"
                 [filterDelay]="0">
          <ng-template pTemplate="caption">
            <div class="flex justify-content-between flex-column sm:flex-row">
                    <span class="p-input-icon-left mb-2">
							<i class="pi pi-search"></i>
							<input pInputText type="text" #filter (input)="onGlobalFilter(dt, $event)"
                     placeholder="Recherche" class="w-full"/>
						</span>
            </div>
          </ng-template>

          <ng-template pTemplate="header">
            <tr>
              <th style="width: 3em">
                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
              </th>
              <th style="font-weight: bold;">Titre</th>
              <th style="font-weight: bold;">EAN</th>
              <th style="font-weight: bold;">Edition</th>
              <th style="font-weight: bold;" *ngIf="livre.photo != null">Page de couverture</th>
              <th style="font-weight: bold;" *ngIf="livre.photo == null">Page de couverture</th>
              <th style="font-weight: bold;">Actions</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-livre let-columns="columns">
            <tr [pSelectableRow]="livre">
              <td>
                <p-tableCheckbox [value]="livre"></p-tableCheckbox>
              </td>
              <td class="table-separator">{{livre.titre}}</td>
              <td class="table-separator">{{livre.ean}}</td>
              <td class="table-separator">{{livre.edition}}</td>
              <td *ngIf="livre.photo !=null"><img  [src]="livre.photo" alt="Image Preview" style="max-width: 100px;"></td>
              <td *ngIf="livre.photo == null"><img  src="../../../assets/im4.jpeg" alt="Image Preview" style="max-width: 100px;"></td>
              <td>
                <button pButton pRipple type="button"  (click)="onDisplayDialogue(livre)"
                        icon="pi pi-pencil" class="p-button-secondary"></button>
                <button pButton pRipple type="button"  icon="pi pi-trash"
                        (click)="deleteElement(livre)"
                        class="p-button-danger"></button>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage" let-columns>
            <tr> <td colspan="3" style="text-align: center; font-size: 1.2em; color: red; font-weight: bold;"> <span class="text-danger"> Aucun livre trouvé ! </span> </td> </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
  <p-dialog header="Ajouter un livre" [(visible)]="display" [style]="{width: '80em', minWidth: '150px'}" [minY]="70" [maximizable]="true" [baseZIndex]="10000" [modal]="true" [responsive]="true">
    <form (ngSubmit)="save(editForm)" name="editForm" role="form" novalidate  #editForm="ngForm">
      <div class="row">
        <div class="col-md-6">
          <div class="flex flex-column gap-2">
            <label for="nom" class="required-input bold-label">Genre littéraire<span class="required-icon"></span></label>
            <p-dropdown [options]="genres" [(ngModel)]="livre.genre"
                        optionLabel="libelle"  name="genre" [filter]="true"
                        appendTo ="body" placeholder="Séléctionner le genre"
                        [style]="{'width': '100%'}"
                        [resetFilterOnHide]='true' [showClear]="true" >
            </p-dropdown>
          </div><br>
          <div class="flex flex-column gap-2">
            <label for="nom" class="required-input bold-label">Titre<span class="required-icon"></span></label>
            <input type="text" id="titre" pInputText name="titre"
                   [(ngModel)]="livre.titre" [style]="{'width': '100%'}" required/>
          </div><br>
          <div class="flex flex-column gap-2">
            <label for="prenom" class="required-input bold-label">EAN<span class="required-icon"></span></label>
            <input type="number" id="prenom" pInputText name="ean"
                   [(ngModel)]="livre.ean" [style]="{'width': '100%'}" required/>
          </div><br>

          <div class="flex flex-column gap-2">
            <label for="nom" class="required-input bold-label">Edition<span class="required-icon"></span></label>
            <input type="text" id="nom" pInputText name="edition"
                   [(ngModel)]="livre.edition" [style]="{'width': '100%'}" required/>
          </div><br>
          <div class="flex flex-column gap-2">
            <label for="nom" class="required-input bold-label">Pays<span class="required-icon"></span></label>
            <p-dropdown [options]="pays" [(ngModel)]="livre.pays"
                        optionLabel="nomPays"  name="libelle" [filter]="true"
                        appendTo ="body" placeholder="Séléctionner le pays"
                        [style]="{'width': '100%'}"
                        [resetFilterOnHide]='true' [showClear]="true" >
            </p-dropdown>
          </div><br>
        </div>
        <div class="col-md-6">
          <div class="flex flex-column gap-2">
            <label for="datePublication" class="required-input bold-label">Année de publication<span class="required-icon"></span></label>
            <input type="number" id="datePublication" pInputText name="annee"
                   [(ngModel)]="livre.annee" [style]="{'width': '100%'}" required/>
          </div><br>
          <div class="flex flex-column gap-2">
            <label for="nom" class="required-input bold-label">Auteur<span class="required-icon"></span></label>
            <p-dropdown [options]="authors" [(ngModel)]="livre.auteur"
                        optionLabel="nom"  name="auteur" [filter]="true"
                        appendTo ="body" placeholder="Séléctionner l'auteur de ce livre"
                        [style]="{'width': '100%'}"
                        [resetFilterOnHide]='true' [showClear]="true" >
            </p-dropdown>
          </div><br>
          <div class="flex flex-column gap-2">
            <label for="prenom" class="required-input bold-label">Résumé<span class="required-icon"></span></label>
            <textarea type="text" id="resume" pInputText name="resume"
                      [(ngModel)]="livre.resume" [style]="{'width': '100%'}" required></textarea>
          </div><br>
        </div>
      </div>
      <p-footer>
        <div class="p-col-12">
          <div class="p-d-flex p-jc-end float-right">
            <div class="flex align-items-center gap-2 ">
              <button type="button" pButton icon="fa fa-close" class="p-button-danger"
                      label="Quitter" (click)="annuler()"></button>
              <button type="submit" pButton icon="fa fa-save" label="Enregistrer"
                      class="p-button-success" [disabled]="editForm.invalid || isSaving">
              </button>
            </div>
          </div>
        </div>
      </p-footer>
    </form>
  </p-dialog>
  <p-dialog header="Supprimer livre(s)" [(visible)]="displayDelete" [modal]="true" [responsive]="true" (onHide)="annuler()"
            [style]="{width: '50em', minWidth: '200px'}" [minY]="70" [maximizable]="true" [baseZIndex]="10000">

    <p-table [value]="livreSelected" dataKey="id">
      <ng-template pTemplate="header" let-columns>
        <tr>

          <th>Titre</th><span class="required-icon"></span>
          <th>EAN</th><span class="required-icon"></span>
          <th>Auteur</th><span class="required-icon"></span>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-livre let-columns="columns">
        <tr>

          <td>{{livre.titre}}</td>
          <td>{{livre.ean}}</td>
          <td>{{livre.auteur?.nom}}</td>

        </tr>
      </ng-template>

    </p-table>
    <p-footer>
      <div class="ui-dialog-buttonpane ui-helper-clearfix">

        <button type="button" pButton icon="fa fa-close" class="p-button-danger"
                label="Fermer" (click)='annulerDelete()'>
        </button>
        <button type="button" pButton icon="fa fa-times"  class="p-button-success" label="Confirmer"
                (click)="deleteAll()">
        </button>

      </div>
    </p-footer>
  </p-dialog>
  <p-dialog></p-dialog>

  <p-toast position="top-right"></p-toast>

  <p-confirmDialog #cd header="Confirmation" icon="pi pi-exclamation-triangle">
    <p-footer>
      <button type="button" class="p-button-secondary" pButton icon="pi pi-times"
              label="NON" (click)="cd.reject()"></button>
      <button type="button" class="p-button-danger" pButton icon="pi pi-check"
              label="OUI" (click)="cd.accept()"></button>
    </p-footer>
  </p-confirmDialog>
</div>


